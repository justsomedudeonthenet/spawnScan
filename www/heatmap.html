<!DOCTYPE html>
<html>
	<head>
		<style>
			#map {
			width: 100%;
			height: 100%;
			margin: 0;
            padding: 0;
            position: absolute;
			left: 0px;
			top: 0px;
			}

			#legend {
				background: #fff;
				padding: 10px;
				margin: 10px;
				border: 1px solid #000;
			}
			#legend h3 {
				margin-top: 0;
			}
		</style>
		<script src="./static/klokantech.js"></script>
	</head>
	<body>
		<div id="map"></div>
		<div id="legend"><h3>Legend</h3></div>
		<script>
			function getFile(path, asynch, callback) {
				var xhr = new XMLHttpRequest();
				xhr.overrideMimeType("application/json");
				xhr.open("GET", path, asynch);
				xhr.onload = function (e) {
					if (xhr.readyState === 4) {
						callback(xhr.responseText);
					}
				};
				xhr.onerror = function (e) {
					console.error(xhr.status);
				};
				xhr.send(null);
			}
			
			var map;

			function initMap() {
				var mapDiv = document.getElementById('map');
				map = new google.maps.Map(mapDiv, {
					center: {lat: 43.1534, lng: -80.2484},
					zoom: 14,
				});
				// Show scanned area
				getFile('./config.php', true, function(response) {
					var data = JSON.parse(response);
					for (var i = 0; i < data.length; i++) {
						var p = data[i];
						new google.maps.Rectangle({
							strokeColor: '#FF0000',
							strokeOpacity: 0.8,
							strokeWeight: 2,
							fillOpacity: 0,
							map: map,
							bounds: {
								north: p['north'],
								south: p['south'],
								east: p['east'],
								west: p['west']
							}
						});
					}
				});
        var queryDict = {};
        location.search.substr(1).split("&").forEach(function(item) {queryDict[item.split("=")[0]] = item.split("=")[1]});
        console.log(queryDict['pid']);

				// Get the pokemon data
				getFile('./pokes.php?pid=' + queryDict['pid'], true, function(response) {
					var pokes = JSON.parse(response);
					var heatmapdata = [];
					for (var i = 0; i < pokes.length; i++) {
							heatmapdata.push(new google.maps.LatLng(pokes[i].lat,pokes[i].lng))
					}
	
					var heatmap = new google.maps.visualization.HeatmapLayer({
						data:heatmapdata
					});
					heatmap.setMap(map);
				});	
			}

		</script>
		<script async defer
			src="https://maps.googleapis.com/maps/api/js?key=API_KEY_HERE&callback=initMap&libraries=visualization">
		</script>
	</body>
</html>
